
<input
  type="text"
  [formControl]="searchControl"
  placeholder="Buscar productos..."
/>
<!-- Modal de advertencia -->
<div class="modal" *ngIf="mostrarAdvertencia">
  <div class="modal-content">
    <h2>锔 Advertencia de sesi贸n</h2>
    <p>Tu sesi贸n expirar谩 en 1 minuto por inactividad.</p>
    <div class="modal-actions">
      <button (click)="mantenerSesion()">Mantener sesi贸n</button>
      <button (click)="cerrarSesion()">Cerrar sesi贸n</button>
    </div>
  </div>
</div>



<!--dashboard de usuario-->
<!--dashboard de usuario-->
<div class="dashboard-layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h3>Men煤</h3>
    <ul>
      <li><button (click)="seccionActiva='perfil'" [class.active]="seccionActiva==='perfil'"> Perfil</button></li>
<li><button (click)="seccionActiva='ordenes'" [class.active]="seccionActiva==='ordenes'"> rdenes</button></li>
<li><button (click)="seccionActiva='estadisticas'" [class.active]="seccionActiva==='estadisticas'"> Estad铆sticas</button></li>
<li><button (click)="seccionActiva='actividad'" [class.active]="seccionActiva==='actividad'"> Actividad</button></li>
<li><button (click)="seccionActiva='configuracion'" [class.active]="seccionActiva==='configuracion'">锔 Configuraci贸n</button></li>

    </ul>
  </aside>

  <!-- Contenido principal -->
  <main class="main-content">
    <div class="dashboard" *ngIf="sesionActivaSinGoogle">
      <h2>Bienvenido, {{ datosdesesion }}</h2>

      <!-- Perfil -->
      <section *ngIf="seccionActiva==='perfil'">
        <h3>Perfil</h3>
        <p>Usuario: {{ datosdesesion }}</p>
        <p>Nombre: {{ nombre }}</p>
        <p>Email: {{ email }}</p>
       
        <p>Fechaderegistro: {{ fechaderegistro }}</p> 
      </section>

      <!-- rdenes -->
      <section *ngIf="seccionActiva==='ordenes'">
        <h3>rdenes recientes</h3>
        <ul>
          <li *ngFor="let order of orders" class="order-card">
            <h3>Orden #{{ order.id }} - Estado: {{ order.status }}</h3>
            <p>Fecha: {{ order.createdAt | date:'short' }}</p>
            <p>Producto: {{ order.productName }}</p>
            <p>Usuario login: {{ order.loginUsername }}</p>
            <p>Usuario MP: {{ order.user.username }} ({{ order.user.email }})</p>
            <p>Total: {{ order.total | currency:'ARS' }}</p>

            <h4>Items:</h4>
            <ul>
              <li *ngFor="let item of order.items">
                {{ item.productName }} - Cantidad: {{ item.quantity }} - Precio: {{ item.price | currency:'ARS' }}
              </li>
            </ul>
          </li>
        </ul>
      </section>

      <!-- Estad铆sticas -->
      <section *ngIf="seccionActiva==='estadisticas'">
        <h3>Estad铆sticas</h3>
        <p>Total gastado: {{ estadisticas.totalGastado | currency }}</p>
        <p>Compras realizadas: {{ estadisticas.compras }}</p>
            <p><strong>ltima compra:</strong> {{ estadisticas.ultimaCompra | date:'short' }}</p>
        
        <p><strong>Monto:</strong> {{ estadisticas.ultimoMonto | currency:'ARS' }}</p>
  <p><strong>Estado:</strong> {{ estadisticas.ultimoEstado }}</p>
      </section>

      <!-- Actividad -->
      <section *ngIf="seccionActiva==='actividad'">
        <h3>Actividad</h3>
        <ul>
    <li *ngFor="let evento of actividad">
      <strong>{{ evento.tipo }}</strong> - {{ evento.descripcion }}
      <br>
      <small>{{ evento.fecha | date:'short' }}</small>
    </li>
        </ul>
      </section>

      <!-- Configuraci贸n -->
      <section *ngIf="seccionActiva==='configuracion'">
        <h3>Configuraci贸n</h3>
          <h3> Actualizar contrase帽a</h3>
  <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
    <label for="password">Nueva contrase帽a:</label>
    <input id="password" type="password" formControlName="nuevaPassword">
    
    <div *ngIf="passwordForm.get('nuevaPassword')?.invalid && passwordForm.get('nuevaPassword')?.touched">
      <small>La contrase帽a debe tener al menos 6 caracteres</small>
    </div>
<p *ngIf="mensajedecambiopassword"><strong> {{ mensajedecambiopassword }}</strong> </p>
    <button type="submit" [disabled]="passwordForm.invalid">Actualizar</button>
      
  </form>


           
        
      <h3> Actualizar nombre de usuario</h3>
  <form [formGroup]="usernameForm" (ngSubmit)="updateUsername()">
    <label for="username">Nuevo nombre de usuario:</label>
    <input id="username" type="text" formControlName="nuevoUsername" >
    
    <div *ngIf="usernameForm.get('nuevoUsername')?.invalid && usernameForm.get('nuevoUsername')?.touched">
      <small>Debe escribir un nombre de usuario </small>
    </div>
<p *ngIf="mensajedecambiousername"><strong>{{ mensajedecambiousername }}</strong></p>
    <button type="submit" [disabled]="usernameForm.invalid">Actualizar</button>
      
  </form>
    
      </section>
    </div>
  </main>
</div>



<div class="formulariologin">

    <form [formGroup]="formulariologin" (ngSubmit)="formulariologindatos()">
      <label>
          <h2>INICIAR SESIN</h2>
        <input formControlName="nombre"  placeholder="Ingresar Nombre" class="search-box" />
        <input formControlName="password"  placeholder="Ingresar password" class="search-box" />
        <span *ngIf="formulariologin.get('nombre')?.invalid && formulariologin.get('nombre')?.touched">
          Deber铆a escribir algo es obligatorio.
          </span>
        <span *ngIf="formulariologin.get('password')?.invalid && formulariologin.get('password')?.touched">
       Deber铆a escribir una contrase帽a
        
        </span>
        <a routerLink="/registrarse">REGISTRARSE</a>
      </label>

      <button type="submit" [style.display]="sesionActivaSinGoogle ? 'none' : 'block'" >Enviar</button>
    </form>
    <p class="datosdesesion" *ngIf="sesionActivaSinGoogle" >USUARIO {{datosdesesion}}</p>
<!-- Bot贸n de cerrar sesi贸n -->
<button *ngIf="sesionActivaSinGoogle" (click)="cerrarSesion()">Cerrar sesi贸n</button>
  </div>

  <pre>{{ datosDebug }}</pre>




<h2>Lista de productos</h2>

<div *ngIf="loading">Cargando productos...</div>
<div *ngIf="error">Ocurri贸 un error al cargar los productos.</div>

<div *ngIf="!loading && !error">
  <div *ngFor="let product of products" class="search-result">  
   
  
  <div class="info">
<div class="product-card">
        <!-- Usar la propiedad imageUrl de la tabla del producto para evitar la repetici贸n
    de la imagen cuandose usa el img sin la base-->
    <img [src]="product.imageUrl" alt="{{ product.name }}" width="80" height="80">
    {{ product.name }} - {{ product.description }} - {{ product.price }}
</div>
  <button (click)="addToCart(product)"  class="addtocart" >Agregar al carrito</button>

    <label for="quantity">Cantidad:</label>
<select [formControl]="quantityControl" id="quantity">
  <option *ngFor="let qty of quantities" [value]="qty">{{ qty }}</option>
</select>
  </div>
  


<!-- Bot贸n para mostrar resumen -->
<button (click)="mostrarResumen()"  *ngIf="!showSummary"  >Comprar ahora</button>

<!-- Resumen de compra -->
<div *ngIf="showSummary" class="resumen">
  <h3>Resumen de compra</h3>
  <p>Producto: {{ product.name }}</p>
  <p>Cantidad: {{ quantityControl.value }}</p>
 <!--se usa el operador de acseso seguro || para evitar error 
 de objeto posible valor null o undefined-->
  <p>Total: {{ product.price * (quantityControl.value || 1) | currency:'ARS' }}</p>


  <button (click)="buyNow(product.id)" class="buynow">Comprar ahora</button>

</div>

</div>





<p>{{errorredir}}</p>
  




